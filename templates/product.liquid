{% assign variant_tmp = product.selected_or_first_available_variant  %}
{% for variant in product.variants %}
{% if variant.available == true and variant.price < variant_tmp.price %}
{% assign variant_tmp = variant %}	
{% endif %}
{% endfor %}

{% unless current_collection %}
{% assign current_collection = collection %}
{% endunless %}

{% assign on_sale = false %}
{% if product.compare_at_price > product.price %}
{% assign on_sale = true %}
{% endif %}

{% assign sold_out = true %}
{% if product.available  %}
{% assign sold_out = false %}
{% endif %}


{% if page.metafields.jvpage.titlePage != 'hide'  %}  
<div class="common-static-header collection-header">
  <div class="parallax-bg" data-stellar-background-ratio="0.25" 
       {% if settings.bg_page_shop_enable %}    
       style="background-image:url({{ 'bg_page_shop.jpg' | asset_url }})"         
       {% endif %}        
       ></div>
  <div class="container">

    <div class="collection-description">
      {% include 'breadcrumb' %}
    </div>

  </div>  
</div>
{% endif %} 


<main role="main" class="wrapper main-content product-style-detail pt-50 {% if settings.product_style_option == 'style-1' %} shop-detail-1-page  {% else %}    shop-detail-2-page  {% endif %} ">
  <div class="container">

    {% if settings.product_style_option == 'style-2' %}
    <div class="row product-style-2">
      <div class="grid-item grid-border--left col-md-9 col-md-offset-3 content-product-detail has-sidebar">    
        {% endif %}    

        <div class="row {% if settings.product_style_option == 'style-2' %}  product-detail-2-wrapper {% endif %}  " itemscope itemtype="http://schema.org/Product">
          <meta itemprop="url" content="{{ shop.url }}{{ product.url }}">
          <meta itemprop="image" content="{{ product.featured_image.src | img_url: 'grande' }}">

          <div class="{% if settings.product_style_option == 'style-1' %} col-lg-7 col-sm-6 col-xs-12  {% else %} col-sm-6 col-xs-12 product-thumbnail-slider-wrapper  {% endif %} ">
            {% include 'product--image' %}
          </div>

          <div class=" {% if settings.product_style_option == 'style-1' %} col-lg-5 col-sm-6 col-xs-12 product-detail-1  {% else %}  col-sm-6 col-xs-12 product-detail-2  {% endif %}">

            <h1 itemprop="name" class="title-product-detail">{{ product.title }}</h1>

            <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">

              {% assign variant = product.selected_or_first_available_variant %}

              <meta itemprop="priceCurrency" content="{{ shop.currency }}">
              <meta itemprop="price" content="{{ variant.price | money }}">

              {% if settings.product_reviews_enable %}
              <div class="product-meta--review rating ">
                <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
              </div>
              {% endif %}

              <div class="desc">
              <h5> {{ 'products.product.description' | t }}</h5>
                {{ product.description }}
              </div>

              <div class="product-item--price price info-price">
                <span id="productPrice" class="h1 color-main">
                  {% include 'price' with variant.price %}
                </span>

                {% if product.compare_at_price_max > product.price %}
                <span class="saleoff">-{{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | money_without_currency | times: 100 | remove: '.0'}}%</span>
                <del id="comparePrice" class="sale-tag large h4">
                  {% assign compare_price = variant.compare_at_price %}
                  {% assign product_price = variant.price %}
                  {% include 'price-sale' %}
                </del>

                {% endif %}  
              </div> 

              <link itemprop="availability" href="http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}">


              {% include 'product--addtocart' %}


              <div class="product-detail-others">

                {% unless variant_tmp and variant_tmp.sku %}
                <p id="sku"{% unless variant_tmp and variant_tmp.sku %} class="hidden"{% endunless %}><span class="uppercase">{{'products.product.sku' | t}} : </span>
                  <span class="color-main ">  {{variant_tmp.sku}}</span>  </p>
                {% endunless %}

                {% if settings.product_vendor_enable %}
                <p class="product-meta" itemprop="brand"> <span class="uppercase">{{'products.product.vendor' | t}} :</span> <span class="color-main ">{{ product.vendor }}</span></p>
                {% endif %}

                {% if settings.social_sharing_products %}
                <p><span class="uppercase">{{'products.product.shares' | t}} :</span> <span class="color-main ">{% include 'social-sharing' %}</span></p>
                {% endif %}

              </div>          


            </div>

          </div>
          {% include 'product--extra-info' %}

        </div>     




        <div class="  {% if settings.product_style_option == 'style-1' %} shop-detail-orther-link  {% else %} shop-detail-orther-link  pt-70 pb-70  {% endif %}">
          <form action="/cart" method="post" class="cart-form " novalidate>
            <a class="border-btn border-btn-lightgray btn-size-3 uppercase" href="/collections/all"> {{ 'cart.general.backtoshop' | t }}</a>
            <button type="submit" name="checkout" class="normal-btn normal-btn-gray btn-size-3 uppercase">
              {{ 'cart.general.checkout' | t }}
            </button>
          </form>          
        </div>

        {% if settings.product_style_option == 'style-1' %} <div class="separator-5"></div>   {% endif %}    


        {% if settings.related_products_enable %}
          {% assign grid_item_width = 'large--one-fifth medium--one-third small--one-half' %}
          {% include 'related-products' %}
        {% endif %}


        {% if settings.product_style_option == 'style-2' %}
      </div>

      <aside class="sidebar sidebar-product collection-filters col-md-3  col-md-jvoffset-12" id="collectionFilters">
        {% include 'collection-sidebar' %}
      </aside>

    </div>

    {% endif %}    


    {{ 'option_selection.js' | shopify_asset_url | script_tag }}
    <script>

      // Pre-loading product images, to avoid a lag when a thumbnail is clicked, or
      // when a variant is selected that has a variant image.
      Shopify.Image.preload({{ product.images | json }}, 'large');

      var selectCallback = function(variant, selector) {

        var $addToCart = $('#addToCart'),
            $productPrice = $('#productPrice'),
            $comparePrice = $('#comparePrice'),
            $variantQuantity = $('#variantQuantity'),
            $quantityElements = $('.quantity-selector, label + .js-qty'),
            $addToCartText = $('#addToCartText'),
            $featuredImage = $('#productPhotoImg');

        if (variant) {
          // Update variant image, if one is set
          // Call timber.switchImage function in shop.js
          if (variant.featured_image) {
            var newImg = variant.featured_image,
                el = $featuredImage[0];
            $(function() {
              Shopify.Image.switchImage(newImg, el, timber.switchImage);
            });
          }

          // Select a valid variant if available
          if (variant.available) {
            // We have a valid product variant, so enable the submit button
            $addToCart.removeClass('disabled').prop('disabled', false);
            $addToCartText.html({{ 'products.product.add_to_cart' | t | json }});

            // Show how many items are left, if below 10
            {% if settings.product_quantity_message %}
            if (variant.inventory_management) {
              if (variant.inventory_quantity < 10 && variant.inventory_quantity > 0) {
                $variantQuantity.html({{ 'products.product.only_left' | t: count: '1' | json }}.replace('1', variant.inventory_quantity)).addClass('is-visible');
              } else {
                $variantQuantity.removeClass('is-visible');
              }
            }
            else {
              $variantQuantity.removeClass('is-visible');
            }
            {% endif %}


            $quantityElements.show();
          } else {
            // Variant is sold out, disable the submit button
            $addToCart.addClass('disabled').prop('disabled', true);
            $addToCartText.html({{ 'products.product.sold_out' | t | json }});
            $variantQuantity.removeClass('is-visible');
            $quantityElements.hide();
          }

          // Regardless of stock, update the product price
          var customPriceFormat = timber.formatMoney( Shopify.formatMoney(variant.price, "{{ shop.money_format }}") );
                                                                          $productPrice.html(customPriceFormat);

                                                     // Also update and show the product's compare price if necessary
                                                     if ( variant.compare_at_price > variant.price ) {
            var priceSaving = timber.formatSaleTag( Shopify.formatMoney(variant.compare_at_price - variant.price, "{{ shop.money_format }}") );
                                                                        {% comment %}
                                                                        priceSaving += ' (' + ( (variant.compare_at_price - variant.price)*100/(variant.compare_at_price) ).toFixed(0) + '%)';
            {% endcomment %}
            $comparePrice.html({{ 'products.general.save_html' | t: saved_amount: '[$]' | json }}.replace('[$]', priceSaving)).show();
          } else {
            $comparePrice.hide();
          }

        } else {
          // The variant doesn't exist, disable submit button.
          // This may be an error or notice that a specific variant is not available.
          $addToCart.addClass('disabled').prop('disabled', true);
          $addToCartText.html({{ 'products.product.unavailable' | t | json }});
          $variantQuantity.removeClass('is-visible');
          $quantityElements.hide();
        }
      };

      jQuery(function($) {
        new Shopify.OptionSelectors('productSelect', {
          product: {{ product | json }},
          onVariantSelected: selectCallback,
          enableHistoryState: true
        });

        // Add label if only one product option and it isn't 'Title'. Could be 'Size'.
        {% if product.options.size == 1 and product.options.first != 'Title' %}
        $('.selector-wrapper:eq(0)').prepend('<label>{{ product.options.first | escape }}</label>');
                                             {% endif %}

                                             // Hide selectors if we only have 1 variant and its title contains 'Default'.
                                             {% if product.variants.size == 1 and product.variants.first.title contains 'Default' %}
                                             $('.selector-wrapper').hide();
        {% else %}
        $('#variantBreak').removeClass('hr--clear');
        {% endif %}
      });
    </script>

{% if settings.product_image_gallery_style == '1' %} 
    {{ 'jquery.zoom.min.js' | asset_url | script_tag }}
{% endif %}    




  </div>

</main>      